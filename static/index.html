<!doctype html>

<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
	<title>Epidemic Go</title>
	<script src="//cdn.socket.io/socket.io-1.2.0.js"></script>

	<!-- Bootstrap -->
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<!--Import materialize.css-->
	<link type="text/css" rel="stylesheet" href="css/materialize.css" media="screen,projection" />
	<!-- Custom CSS -->
	<link href="css/custom.css" rel="stylesheet">
	<!--Import Google Icon Font-->
	<link href="//fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<!--Let browser know website is optimized for mobile-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>


<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

<!-- TODO: Include Map API (Probably Google Maps) -->
<style>
	#map {
		position: absolute;
		left: 0;
		top: 0;
		height: 100%;
		width: 100%;
		z-index: -1;
	}
</style>

</head>

<body>

	<!--Navbar & Sidebar-->
	<nav>
		<div class="nav-wrapper blue lighten-1">
			<a href="#" class="brand-logo center">Epidemic Go</a>
			<a href="#"><i class="material-icons right">perm_identity</i></a>
			<ul id="slide-out" class="side-nav">
				<li><a href="#!">Home</a></li>
				<li><a href="#!">Social</a></li>
			</ul>
			<a href="#" data-activates="slide-out" class="button-collapse"><i class="material-icons">menu</i></a>
		</div>
	</nav>
	<!--Navbar & Sidebar-->
	<div id="map"></div>
	<script>
		var map;
		var center = null;

		function initMap() {
			var uluru = {
				lat: 32,
				lng: -117
			};
			map = new google.maps.Map(document.getElementById('map'), {
				zoom: 14,
				center: uluru
			});
			if (center) {
				map.setCenter({
					lat: location.latitude,
					lng: location.longitude
				});
			}
			navigator.geolocation.getCurrentPosition(function(e, x) {
				center = e.coords;
				if (map) {
					map.setCenter({
						lat: e.coords.latitude,
						lng: e.coords.longitude
					});
					socket.emit("joined", JSON.stringify({
						lat: e.coords.latitude,
						lng: e.coords.longitude
					}));
					var marker = new google.maps.Marker({
						position: {
							lat: e.coords.latitude,
							lng: e.coords.longitude
						},
						map: map
					});
				}
			});
		}
	</script>
	<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBC75EnaIuHo--O2S_dMWNP7WEIsmGZjAg&callback=initMap">
	</script>
	<a class="btn-floating btn-large waves-effect waves-light blue lighten-1" id="Infect-button">Infect!</a>



	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="js/bootstrap.min.js"></script>
	<!--Import jQuery before materialize.js-->
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="js/materialize.min.js"></script>

	<script>
		$(".button-collapse").sideNav();
		var socket = io();
		var markers = [];
		var id = Math.random();
		socket.on("update", function(evt) {
			var locations = JSON.parse(evt);
			if(map){
				markers.forEach(function(marker){
					marker.setMap(null);
				});
				markers = [];
				console.log(locations);
				locations.forEach(function(coords){
					markers.push(new google.maps.Marker({
						position: coords,
						map: map
					}));
				});
			}
		});
	</script>
</body>

</html>
