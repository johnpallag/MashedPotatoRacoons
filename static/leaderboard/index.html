<!doctype html>

<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
	<title>Epidemic Go - Leaderboard</title>
	<script src="//cdn.socket.io/socket.io-1.2.0.js"></script>
	<link href="//fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

	<!-- Custom CSS -->
	<link href="../css/custom.css" rel="stylesheet">
	<!--Import Google Icon Font-->
	<link href="//fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<!--Let browser know website is optimized for mobile-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css">

	<!--Import jQuery before materialize.js-->
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>

	<!-- Compiled and minified JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/js/materialize.min.js"></script>
	<link href="../css/style.css" rel="stylesheet" />
	<style>
		.virus-small {
			height: 50px;
			width: 50px;
			background-size: contain;
			background-position: center center;
			background-repeat: no-repeat;
			float: left;
			border-radius: 50%;
			margin-right: 15px;
		}

		.blue.lighten-1 {
			background-color: #a04799 !important;
		}
	</style>
</head>

<body>

	<!--Navbar & Sidebar-->
	<nav>
		<div class="nav-wrapper blue lighten-1">
			<a href="#" class="brand-logo center">Epidemic Go</a>
			<a href="#"><i class="material-icons right">perm_identity</i></a>

			<ul id="slide-out" class="side-nav">
				<li>
					<div class="userView">
						<div class="background blue">

						</div>

						<a href="#!user"><img class="circle" src="../images/profile.png"></a>
						<a href="#!name"><span class="profile-name white-text name">Alok Mysore</span></a>
						<div class="levelup">
							<div class="determinate" style="width: 70%"></div>
						</div>
						<a href="#!email"><span class="white-text">level 6</span></a>
					</div>
				</li>

				<li><a href="#!"><i class="material-icons">dashboard</i>Home</a></li>
				<li><a href="#!"><i class="material-icons">play_arrow</i>Play Now</a></li>
				<li><a href="#!"><i class="material-icons">person_pin</i>Social</a></li>
				<li>
					<div class="divider"></div>
				</li>
				<li><a class="waves-effect" href="../howtoplay.html">How to play</a></li>
				<li><a class="waves-effect" href="#!">Setting</a></li>
			</ul>

			<a href="#" data-activates="slide-out" class="button-collapse"><i class="material-icons">menu</i></a>


		</div>
	</nav>
	<!--Navbar & Sidebar-->
	<div class="container">
		<div class="row">
			<p>Infect more people to gain points</p>
			<ul class="collection" id="leaderboard">
			</ul>
		</div>
	</div>
	<script>
		const socket = io();
		var players = {};
	  socket.on("data", function(evt) {
	    players = JSON.parse(evt);
			leaderboard();
		});
		function ordinal_suffix_of(i) {
		    var j = i % 10,
		        k = i % 100;
		    if (j == 1 && k != 11) {
		        return i + "st";
		    }
		    if (j == 2 && k != 12) {
		        return i + "nd";
		    }
		    if (j == 3 && k != 13) {
		        return i + "rd";
		    }
		    return i + "th";
		}
		function leaderboard() {
			var arr = Object.keys(players).sort(function(a, b) {
				return (players[a].points || 0) > (players[b].points || 0);
			});
			var leaders = arr.map(function(id) {
				return players[id];
			}).slice(0, 9);
			$("#leaderboard").html("");
			var i = 1;
			leaders.forEach(function(leader){
				var str = '<li class="collection-item avatar">' +
					'<img src="../images/' + (leader.virus.image || 0) + '.png" alt="" class="circle"' +  'style="background-color:' + (leader.virus.params.color || 'rgb(100,100,225)') + '">' +
					'<span class="title">' + (leader.name || "Unknown") + '</span>' +
					'<p>' + (leader.points || 0) + ' Points</p>' +
					'<a href="#!" class="secondary-content">' + ordinal_suffix_of(i++) + '</a>' +
					'</li>'
				$("#leaderboard").append(str);
			});
		}
		$('.collapsible').collapsible();
		$(".button-collapse").sideNav();
	</script>
</body>

</html>
